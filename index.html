<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Join Mattermost.fsinf.at!</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="canonical" href="https://mm.fsinf.at/">
<link rel="icon" type="image/png" href="https://mattermost.fsinf.at/static/images/favicon/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="https://mattermost.fsinf.at/static/images/favicon/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="https://mattermost.fsinf.at/static/images/favicon/favicon-96x96.png" sizes="96x96">
<style>
body { font-family: sans-serif; max-width: 60ch; padding: 2ch; margin: auto; }
input { margin-bottom: 1em; padding: 8px 4px; width: 100%; box-sizing: border-box; }
label { font-weight: bold; display: block; }
form { max-width: 200px; }
footer { margin-top: 2em; border-top: 1px solid #aaa; padding: 0.5em; font-size: small; }
#matrikel { letter-spacing: 0.1em; }
#tagline { font-size: large; }
#success {background-color: palegreen }
.error:not(:empty) {background-color: salmon;}
.error:not(:empty), #success { padding: 5px; margin: 1em 0; border-radius: 5px; }
button {
	padding: 0.5em;
	width: 100%;
	font-size: 1.3em;
	background-color: #53b91b;
	color: white;
	cursor: pointer;
	border: 0;
	border-bottom: 5px solid #218227;
	border-radius: 3px;
}
button:active { border: 0; margin-top: 5px; }
form { margin: 1em; }
h1 { color: #166de0; }
.hint {
	position: relative;
	width: 1em;
	text-align: center;
	font-weight: normal;
	float: right;
	background: #ececec;
	color: #555;
	cursor: default;
}
.hint p {
	display: none;
	position: absolute;
	right: 0;
	width: 200px;
	background: white;
	top: 10px;
	text-align: left;
	box-shadow: 10px 10px 10px #0002;
	padding: 0.5em;
	font-size: 0.9em;
	z-index: 1;
	color: black;
}
.hint:hover p { display: block }
</style>
</head>
<body>
	<h1>Join mattermost<small>.fsinf.at</small>!</h1>
	<p id=tagline>Deine Chat-Plattform fürs Informatik-Studium an der TU Wien.</p>
<noscript><div class=error>Diese Seite und Mattermost erfordern JavaScript.</div></noscript>
<div id=error class=error></div>
Already have an account? <a href="https://mattermost.fsinf.at/">Log in</a>.
<form id=form>
<span class=hint>?<p>Steht auf deiner TUCard. Wird anderen Usern nicht angezeigt.</p></span>
<label for=matrikel>Matrikelnummer</label> <input id=matrikel required minlength=7 maxlength=8 pattern="[0-9]+" size=8 />

<label for=username>Username</label> <input id=username required />

<span class=hint>?<p>Bitte verwende ein neues Passwort.</p></span>
<label for=password>Passwort</label> <input id=password type=password required />

<button>Sign up</button>
</form>
<small>By proceeding, you agree to our
<a href="https://wiki.fsinf.at/wiki/Mattermost">Terms of Service</a> and
<a href="https://www.fsinf.at/datenschutz">Privacy Policy</a>.</small>
<footer>Ein Service deiner <a href="https://www.fsinf.at/">Fachschaft Informatik</a>.</footer>
<script>
let form = document.getElementById('form');
let errorDiv = document.getElementById('error');
if (!window.fetch) {
	errorDiv.textContent = 'Dein Browser unterstützt kein fetch(). Bitte installiere einen aktuellen Browser, wie etwa Firefox.';
}
form.addEventListener("submit", async function(e){
	e.preventDefault();
	errorDiv.textContent = '';

	let user = 'e' + document.getElementById('matrikel').value;
	let email = user + '@student.tuwien.ac.at';
	let response = await fetch('/api/users', {
		  method: 'POST',
		  headers: {
			      'Content-Type': 'application/json;charset=utf-8'
			    },
		body: JSON.stringify({
			email: email,
			username: document.getElementById('username').value,
			password: document.getElementById('password').value
		})
	});
	if (response.status == 400){
		let error = await response.json();
		errorDiv.textContent = error.message;
	} else if (response.status == 201){
		form.outerHTML = '<div id=success>Dein Account wurde erfolgreich erstellt! Bitte bestätige unsere Email an ' + email + '.<br>'
		+'Falls du dir diesen Email-Account noch nicht eingerichtet hast, <a href="https://mail.student.tuwien.ac.at/webmail/">melde dich zur Webmail</a> mit Usernamen '+user+ ' und deinem TU-Passwort an.</div>';
	}
}, false);
</script>
</body>
</html>
